

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chiripa.Segment &mdash; Chiripa -- CHI inteRactIon PArameter. 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Chiripa -- CHI inteRactIon PArameter.
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/generalintro.html">General introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/setupstructures.html">Setup structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/keywords.html">Chiripa keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/usermanual.html">USER MANUAL</a></li>
</ul>
<p class="caption"><span class="caption-text">API Python Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/api-docs.html">Python API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chiripa -- CHI inteRactIon PArameter.</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>chiripa.Segment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for chiripa.Segment</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">from</span> <span class="nn">openbabel</span> <span class="kn">import</span> <span class="n">openbabel</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">chiripa</span> <span class="k">as</span> <span class="nn">chi</span>

<div class="viewcode-block" id="Segment"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment">[docs]</a><span class="k">class</span> <span class="nc">Segment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Class to represent molecules</span>


<span class="sd">    There are two ways to build a Segment object:</span>

<span class="sd">        1. Segment(filecoord=&#39;ethylene.pdb&#39;)</span>
<span class="sd">        2. Segment(natoms=2, xlist= [], ylist=[], zlist = [], elements = [])</span>

<span class="sd">    If **filecoord** is present, the paremeters **natoms**, **xlist**, **ylist**, **zlist** and **elementlist** are ignored.</span>
<span class="sd">    Otherwise, these parameters must be consistent.</span>

<span class="sd">    if **filetop** is not given, then the topology is guessed.</span>

<span class="sd">    if **filetypeatoms** is present, the types assignation is done according to the file.</span>
<span class="sd">    The order of the atoms must be the same that the order in the coordinates and topology files.</span>
<span class="sd">    The format of this file must be the following:</span>

<span class="sd">    .. code-block::</span>

<span class="sd">                &lt;Number&gt; &lt;Atom&gt; &lt;type_of_atom&gt;</span>
<span class="sd">                1 C c3</span>
<span class="sd">                2 C c3</span>
<span class="sd">                3 C c3</span>
<span class="sd">                ...</span>
<span class="sd">                14 H hc</span>

<span class="sd">    .. warning::</span>
<span class="sd">                Be careful when use np.transpose function. This function seems to change the order of the array to</span>
<span class="sd">                &quot;Fortran-type&quot; instead to C-Order. If use np.transpose you will use np.ascontiguousarray</span>

<span class="sd">                Example:</span>

<span class="sd">                a = np.tranpose(b) --&gt; a in Fortran order irrespective of the order of C</span>

<span class="sd">                a = np.ascontiguousarray(np.transpose(b)) --&gt; a in C order</span>

<span class="sd">                This issue is important when use mode=&quot;c&quot; in pyx files for Cython</span>

<span class="sd">    .. warning::</span>
<span class="sd">                For big molecules (&gt;1000 atoms) deactivate the guessing of topology (guesstopol=False)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.__init__"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">filecoord</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filetop</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filetypeatoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">natoms</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">xlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">elementlist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">guesstopol</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dummy_head</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dummy_tail</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Constructor of a Segment object</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the segment</span>
<span class="sd">            filecoord (str): Path of the coordinates filecoord (Format: PDB, GRO, XYZ)</span>
<span class="sd">            filetop (str): Path of the topology (Format: PDB)</span>
<span class="sd">            filetypeatoms (str): Name of the file containing the matching between atoms and atomtypes.</span>
<span class="sd">                This is used mainly to assign the reevaluated distances</span>
<span class="sd">                by `Okuwaki_ et_ al_. (Table 2) &lt;https://pubs.acs.org/doi/abs/10.1021/acs.jpcb.7b08461&gt;`_</span>
<span class="sd">            natoms (int): Number of atoms</span>
<span class="sd">            xlist (list, float): Float numbers x component of the coordinates (in angstroms)</span>
<span class="sd">            ylist (list, float): y component of the coordinates (in angstroms)</span>
<span class="sd">            zlist (list, float): z component of the coordinates (in angstroms)</span>
<span class="sd">            elementlist (list, str): Element Symbol</span>
<span class="sd">            guesstopol (bool): If True activate the guessing of topology based in a distance algorithm.</span>
<span class="sd">            dummy_head (int): Index of the atom acting as dummy head atom to mimic polymer chain</span>
<span class="sd">            dummy_tail (int): Index of the atom acting as dummy tail atom to mimic polymer chain</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filecoord</span> <span class="o">=</span> <span class="n">filecoord</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filetop</span> <span class="o">=</span> <span class="n">filetop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;Output&quot;</span><span class="p">)</span> <span class="c1">#&quot;&quot;Segment&quot;, append=True, )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_typeelements</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">filecoord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_disk</span><span class="p">(</span><span class="n">filecoord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">ylist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">ylist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">zlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">zlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="n">natoms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xlist</span><span class="p">),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylist</span><span class="p">),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zlist</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elementlist</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_parameter_consistence</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_head_atom</span> <span class="o">=</span> <span class="n">dummy_head</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dummy_tail_atom</span> <span class="o">=</span> <span class="n">dummy_tail</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_charge</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isBOassigned</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">guesstopol</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">filecoord</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">filetop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1">#self._topology = None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">nvert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">guess_bonds_topology</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">filetop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">nvert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">guess_bonds_topology</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_topology_from_disk</span><span class="p">(</span><span class="n">filetop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_filetypeatoms</span> <span class="o">=</span> <span class="n">filetypeatoms</span>
        <span class="k">if</span> <span class="n">filetypeatoms</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_typeatoms</span><span class="p">(</span><span class="n">filetypeatoms</span><span class="p">)</span></div>

    <span class="c1"># ***********************************************************************************</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Returns the state of the attributtes of an instance&quot;&quot;&quot;</span>

        <span class="n">objstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
                <span class="n">objstr</span> <span class="o">+=</span>  <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">objstr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;: NOT SET&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">objstr</span>

    <span class="c1"># ***********************************************************************************</span>
    <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">Segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">guesstopol</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">s</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span>
        <span class="n">s</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="p">)</span>
        <span class="n">s</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">_filecoord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filecoord</span>
        <span class="n">s</span><span class="o">.</span><span class="n">_filetop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filetop</span>
        <span class="n">s</span><span class="o">.</span><span class="n">_filetypeatoms</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filetypeatoms</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeelements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">_typeelements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_typeelements</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">s</span>

    <span class="c1"># ***********************************************************************************</span>
    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">par</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">par</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">):</span>
                <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">par</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">chi</span><span class="o">.</span><span class="n">Segment</span><span class="p">):</span>
                <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">par</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">par</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">par</span>

        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.assign_bond_orders"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.assign_bond_orders">[docs]</a>    <span class="k">def</span> <span class="nf">assign_bond_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;This function assigns bond orders to the bonds according to the algorithm reported in:</span>

<span class="sd">        &quot;Automated simultaneous assignment of bond orders and formal charges&quot;</span>
<span class="sd">        Ivan D. Welsh and Jane R. Allison</span>
<span class="sd">        J. Cheminform (2019) 11:18</span>

<span class="sd">        https://doi.org/10.1186/s13321-019-0340-0</span>

<span class="sd">        The function uses the external software ``indigo-bondorders`` (located in thirdparty/indigo-bondorder).</span>
<span class="sd">        This code is compiled and installed in thirdparty/indigox</span>


<span class="sd">        .. warning::</span>
<span class="sd">            The structure to assign bonds needs to have all hydrogen bonds correctly placed.</span>
<span class="sd">            United atom models do not work with this function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#sys.path.insert(0, &quot;/home/jramos/PycharmProjects/CHIPAR_2/&quot;)</span>
        <span class="kn">import</span> <span class="nn">indigox</span> <span class="k">as</span> <span class="nn">ix</span>

        <span class="c1"># Periodic Table data from indigox</span>
        <span class="n">PT</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">PeriodicTable</span><span class="p">()</span>
        <span class="c1"># Build a molecule in the indigox framework</span>
        <span class="n">mol</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">Molecule</span><span class="p">()</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">SetTotalCharge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_charge</span><span class="p">)</span>

        <span class="c1"># Add all atoms in a dictionary and get the bonds in the</span>
        <span class="c1"># framework of indigox program</span>
        <span class="n">all_atoms</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="n">bonds_topo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">get_edges</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">bonds_topo</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">:</span>
                <span class="c1"># Element of i</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">all_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">NewAtom</span><span class="p">(</span><span class="n">PT</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">all_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">e</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">all_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">all_atoms</span><span class="p">:</span>
                <span class="c1"># Element of j</span>
                <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">all_atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">NewAtom</span><span class="p">(</span><span class="n">PT</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">all_atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SetIndex</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">e</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                <span class="n">all_atoms</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

            <span class="n">mol</span><span class="o">.</span><span class="n">NewBond</span><span class="p">(</span><span class="n">all_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">all_atoms</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>

        <span class="c1"># Setup to use the FPT algorithm with single electrons without preplacing</span>
        <span class="c1"># to calculate bond orders and formal charges</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="n">ix</span><span class="o">.</span><span class="n">Options</span><span class="o">.</span><span class="n">AssignElectrons</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">ALGORITHM</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">Algorithm</span><span class="o">.</span><span class="n">FPT</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">FPT</span><span class="o">.</span><span class="n">ADD_EDGES_TO_TD</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">FPT</span><span class="o">.</span><span class="n">MINIMUM_PROPAGATION_DEPTH</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">opts</span><span class="o">.</span><span class="n">USE_ELECTRON_PAIRS</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Calculate bond orders and formal charges.</span>
        <span class="c1"># Count have the ttotal number of resonance structures</span>
        <span class="n">nresonances</span> <span class="o">=</span> <span class="n">mol</span><span class="o">.</span><span class="n">AssignElectrons</span><span class="p">()</span>
        <span class="c1">#print(&quot;{} resonace structure(s) calculated with a score of {}.&quot;.format(nresonances, mol.GetMinimumElectronAssignmentScore()))</span>

        <span class="c1"># Sum all order bonds for the resonace structures.</span>
        <span class="k">for</span> <span class="n">iresonance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nresonances</span><span class="p">):</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">ApplyElectronAssignment</span><span class="p">(</span><span class="n">iresonance</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ibond</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">():</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">ibond</span><span class="o">.</span><span class="n">GetSourceAtom</span><span class="p">()</span><span class="o">.</span><span class="n">GetIndex</span><span class="p">()</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">ibond</span><span class="o">.</span><span class="n">GetTargetAtom</span><span class="p">()</span><span class="o">.</span><span class="n">GetIndex</span><span class="p">()</span>
                <span class="n">bo</span> <span class="o">=</span>  <span class="n">ibond</span><span class="o">.</span><span class="n">GetOrder</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">bo</span> <span class="o">==</span> <span class="n">bo</span><span class="o">.</span><span class="n">SINGLE_BOND</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.0</span>
                <span class="k">elif</span> <span class="n">bo</span> <span class="o">==</span> <span class="n">bo</span><span class="o">.</span><span class="n">DOUBLE_BOND</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.0</span>
                <span class="k">elif</span> <span class="n">bo</span> <span class="o">==</span> <span class="n">bo</span><span class="o">.</span><span class="n">TRIPLE_BOND</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">3.0</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">3.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================================&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning!!!! -&gt; Bond order cannot be assigned &quot;</span>
                          <span class="s2">&quot;between </span><span class="si">{}</span><span class="s2"> and </span><span class="si">{}</span><span class="s2"> atoms&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">bo</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=================================================&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_isBOassigned</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Correct for aromaticity</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">ncols</span><span class="p">):</span>
                <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">%</span> <span class="n">nresonances</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nresonances</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nresonances</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.calc_vdw_volume_VABC"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.calc_vdw_volume_VABC">[docs]</a>    <span class="k">def</span> <span class="nf">calc_vdw_volume_VABC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Calculation of the van der Waals volume using the method reported by Zhao et al.</span>

<span class="sd">        &quot;Fast Calculation of van der Waals Volume as a Sum of Atomic and</span>
<span class="sd">        Bond Contributions and Its Application to Drug Compounds&quot;,  J. Org. Chem. 2003, 68, 7368-7373</span>
<span class="sd">        https://pubs.acs.org/doi/10.1021/jo034808o.</span>

<span class="sd">        The VdW radii and volume are taken from</span>
<span class="sd">        element_vdw_vmd_radius_bondi and element_vdw_vmd_volume_bondi, respectively.</span>

<span class="sd">        The formula (4) of the article will be used in this function:</span>

<span class="sd">        .. image:: ../imgs/volume_vdw.png</span>
<span class="sd">            :width: 400pt</span>


<span class="sd">        Returns:</span>
<span class="sd">            (tuple): tuple containing:</span>

<span class="sd">                ``volume_vdw`` (float) Van der waals volume using equation 4 in (angstroms^3/molecule).</span>
<span class="sd">                ``volume_tsar`` (float) Van der waals volume using equation 6 in (angstroms^3/molecule).</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">:</span>
            <span class="n">s1</span> <span class="o">+=</span> <span class="n">chi</span><span class="o">.</span><span class="n">element_vdw_vmd_volume_bondi</span><span class="p">[</span><span class="n">iatom</span><span class="p">]</span>

        <span class="n">mol</span> <span class="o">=</span> <span class="n">openbabel</span><span class="o">.</span><span class="n">OBMol</span><span class="p">()</span>

        <span class="n">obConversion</span> <span class="o">=</span> <span class="n">openbabel</span><span class="o">.</span><span class="n">OBConversion</span><span class="p">()</span>
        <span class="n">obConversion</span><span class="o">.</span><span class="n">SetInAndOutFormats</span><span class="p">(</span><span class="s2">&quot;pdb&quot;</span><span class="p">,</span> <span class="s2">&quot;fix&quot;</span><span class="p">)</span>


        <span class="n">obConversion</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filecoord</span><span class="p">)</span>

        <span class="n">Rg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetSSSR</span><span class="p">())</span>
        <span class="n">RA</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetSSSR</span><span class="p">()</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">IsAromatic</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">])</span>
        <span class="n">RNR</span> <span class="o">=</span> <span class="n">Rg</span> <span class="o">-</span> <span class="n">RA</span>
        <span class="n">NB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Rg</span>

        <span class="n">volume_vdw</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="mf">5.92</span><span class="o">*</span><span class="n">NB</span> <span class="o">-</span><span class="mf">14.7</span><span class="o">*</span><span class="n">RA</span> <span class="o">-</span><span class="mf">3.8</span><span class="o">*</span><span class="n">RNR</span>

        <span class="n">volume_tsar</span> <span class="o">=</span> <span class="mf">0.801</span><span class="o">*</span><span class="n">volume_vdw</span> <span class="o">+</span> <span class="mf">0.18</span>

        <span class="k">return</span> <span class="n">volume_vdw</span><span class="p">,</span> <span class="n">volume_tsar</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.center_of_geom"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.center_of_geom">[docs]</a>    <span class="k">def</span> <span class="nf">center_of_geom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomlist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the center of geometry of the current coordinates</span>

<span class="sd">        Args:</span>
<span class="sd">            atomlist (list): Index of the atoms to calculate the center of geometry. If ``None`` all atoms are used</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``cog``: ndarray[3] of float64. Coordinates of the ``Segment`` geometry center</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">atomlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomlist</span><span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">atomlist</span><span class="o">=</span><span class="n">atomlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
            <span class="n">tmp</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">iatom</span><span class="p">,:]</span>

        <span class="n">cog</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">/</span><span class="n">natoms</span>
        <span class="k">return</span> <span class="n">cog</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.center_of_mass"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.center_of_mass">[docs]</a>    <span class="k">def</span> <span class="nf">center_of_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomlist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the center of mass of the current coordinates</span>

<span class="sd">        Args:</span>
<span class="sd">            atomlist (list): Index of the atoms to calculate the center of mass. If ``None`` all atoms are used</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``com``: ndarray[3] of float64. Coordinates of the ``Segment`` center of mass</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">atomlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">natoms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomlist</span><span class="p">)</span>

        <span class="n">mtotal</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">atomlist</span><span class="o">=</span><span class="n">atomlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">atomlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">atomic_mass</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">[</span><span class="n">iatom</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">atomic_mass</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">[</span><span class="n">atomlist</span><span class="p">[</span><span class="n">iatom</span><span class="p">]]]</span>
            <span class="n">mtotal</span> <span class="o">+=</span> <span class="n">m</span>
            <span class="n">tmp</span> <span class="o">+=</span> <span class="n">c</span><span class="p">[</span><span class="n">iatom</span><span class="p">,:]</span><span class="o">*</span><span class="n">m</span>

        <span class="n">com</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">/</span><span class="n">mtotal</span>
        <span class="k">return</span> <span class="n">com</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.check_parameter_consistence"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.check_parameter_consistence">[docs]</a>    <span class="k">def</span> <span class="nf">check_parameter_consistence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;It checks the length of the parameters passed through the constructor.</span>

<span class="sd">        The length of the x, y, z and element arrays must be equal to the number ot atoms.</span>
<span class="sd">        If there is not consistency raises a ValueError otherwise return True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True: if all parameters are consistent</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">condition</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">condition</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">======== ERROR ==========</span><span class="se">\n</span><span class="s2">&quot;</span> \
                   <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordinates arrays must have equal length and equal to number of atoms</span><span class="se">\n</span><span class="s2">&quot;</span> \
                   <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Length coords: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> \
                   <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Length Elements: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span>\
                   <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Number of atoms: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> \
                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordfile: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> \
                    <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Topofile: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> \
                   <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">======== ERROR ==========</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filecoord</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filetop</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">======== ERROR ==========</span><span class="se">\n</span><span class="s2">&quot;</span> \
                       <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordinates arrays must have equal length and equal to number of atoms</span><span class="se">\n</span><span class="s2">&quot;</span> \
                       <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">======== ERROR ==========</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span> <span class="p">(</span><span class="s2">&quot;Coordinates arrays must have equal length and equal to number of atoms&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.euler_orientation"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.euler_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">euler_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iseed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        New coordinates of the atoms accordingly to random Euler angles.</span>
<span class="sd">        There are many definitions of the Euler angles</span>
<span class="sd">        (see: https://en.wikipedia.org/wiki/Euler_angles)</span>

<span class="sd">        The definition here used is that given in:</span>

<span class="sd">        .. code-block::</span>

<span class="sd">            MATHEMATICAL METHODS FOR PHYSICISTS</span>
<span class="sd">            SEVENTH EDITION</span>
<span class="sd">            George B. Arfken, Hans J. Weber, Frank E. Harris</span>
<span class="sd">            pag: 140-142</span>

<span class="sd">        .. image:: ../imgs/euler_book.png</span>

<span class="sd">        Parameters:</span>
<span class="sd">            iseed (int): Seed for the pseudo-random number generator. If ``None`` the seed is created from the current system time</span>
<span class="sd">                otherwise a deterministic random data using the ``iseed`` value is expected</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``euler``: , list of floats, :math:`{\\alpha}`, :math:`{\\beta}` and :math:`{\\gamma}` values for the Euler angles in radians</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Generate euler angles ========</span>
        <span class="k">if</span> <span class="n">iseed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">euler</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">generate_random_euler_angles</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">euler</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">generate_random_euler_angles</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">iseed</span><span class="p">)</span>

        <span class="c1"># Create rotation matrix</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">euler_rotation_matrix</span><span class="p">(</span><span class="n">euler</span><span class="p">)</span>
        <span class="c1"># Take the transpose of the coordinates</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()))</span>
        <span class="c1"># Change the coordinates (R) dot-product (column vector of the coordinates)</span>
        <span class="c1">#print(ref.flags)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">C</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">euler</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.get_coords"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.get_coords">[docs]</a>    <span class="k">def</span> <span class="nf">get_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">atomlist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the coordinates of the segment</span>

<span class="sd">        Parameters:</span>
<span class="sd">            atomlist (list): Index of the atoms to return. If ``None`` all atoms are returned</span>

<span class="sd">        Returns:</span>
<span class="sd">            ``coords`` : ndarray[natoms, 3], natoms = self._natoms or len(atomlist)). Coordinates array</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">atomlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tmp_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">atomlist</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">atomlist</span><span class="p">:</span>
                <span class="n">tmp_coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">tmp_coords</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.load_from_disk"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.load_from_disk">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper to load the structure from disk. Allowed files are pdb, xyz and gro files.</span>
<span class="sd">        The format of the file is taken from the extension of the file. If this extension is unkown then</span>
<span class="sd">        the method raises an exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the file in the disk</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span> <span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.pdb&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_pdb_from_scratch</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.xyz&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_xyz_from_scratch</span> <span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;.gro&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_gro_from_scratch</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.sdf&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_sdf_coordtopo_from_scratch</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span> <span class="p">(</span><span class="s2">&quot;Unkown molecular format for file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unkown molecular format for file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.printerror"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.printerror">[docs]</a>    <span class="k">def</span> <span class="nf">printerror</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg1</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print the error message msg1 to the logger</span>

<span class="sd">        Args:</span>
<span class="sd">            msg1 (str): Message error</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg1</span><span class="p">)</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_gro_from_scratch"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_gro_from_scratch">[docs]</a>    <span class="k">def</span> <span class="nf">read_gro_from_scratch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gro_path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the coordinates from a gro file. It checks if the file exist</span>

<span class="sd">        Args:</span>
<span class="sd">            gro_path (str): Path to the file in the disk</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">gro_path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">gro_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;GRO file must be provided&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;chipar.segment.read_gro_from_scratch requires an existing file as argument&#39;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="n">iline</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#chainid = 1</span>
        <span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">iline</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="c1">#resid = int(line[0:5].strip())</span>
            <span class="c1">#resname = line[5:10].strip()</span>
            <span class="n">atomname</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="c1">#force field name</span>
            <span class="c1">#tag = int(line[15:20].strip())</span>
            <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">28</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">28</span><span class="p">:</span><span class="mi">36</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">zlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">36</span><span class="p">:</span><span class="mi">44</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">*</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">elist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atomname</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="n">iline</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xlist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zlist</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_pdb_from_scratch"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_pdb_from_scratch">[docs]</a>    <span class="k">def</span> <span class="nf">read_pdb_from_scratch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdb_path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read thecoordinates from a pdb file. It checks if the file exist</span>

<span class="sd">        Args:</span>
<span class="sd">            pdb_path (str): Path to the file in the disk</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">pdb_path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pdb_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;PDB file must exist</span><span class="se">\n</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> does not exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pdb_path</span><span class="p">))</span>
            <span class="n">exit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ATOM&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;HETATM&#39;</span><span class="p">):</span>
                <span class="c1">#tag = int(line[6:11].strip())</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="c1">#resname = line[17:20].strip()</span>
                <span class="c1">#chainid = line[21]</span>
                <span class="c1">#resid = line[22:26].strip()</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">38</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">:</span><span class="mi">54</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                <span class="n">elem</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="mi">76</span><span class="p">:</span><span class="mi">78</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">elem</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">elist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">elist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
                <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">zlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xlist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zlist</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_sdf_coordtopo_from_scratch"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_sdf_coordtopo_from_scratch">[docs]</a>    <span class="k">def</span> <span class="nf">read_sdf_coordtopo_from_scratch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sdf_path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read coordinates and topology from a SDF file</span>

<span class="sd">        Args:</span>
<span class="sd">            sdf_path (str): Path to the sdf file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">sdf_path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sdf_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;SDF file must be provided&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;chipar.segment.read_sdf_coordtopo_from_scratch requires an existing file as argument&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PysimmError</span><span class="p">(</span><span class="s1">&#39;pysimm.system.read_mol requires either &#39;</span>
                              <span class="s1">&#39;file or string as argument&#39;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">nbonds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">nvert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>

        <span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;V2000&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">charge</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
                <span class="n">zlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
                <span class="n">elist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbonds</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">iatom</span><span class="p">,</span> <span class="n">jatom</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">add_edge</span><span class="p">([</span><span class="n">iatom</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">jatom</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">iatom</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">jatom</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">jatom</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iatom</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>

        <span class="k">elif</span> <span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;V3000&#39;</span><span class="p">:</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">nbonds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">idf</span><span class="p">,</span> <span class="n">elem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">charge</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">zlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="n">elist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>

            <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbonds</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">idf</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">iatom</span><span class="p">,</span> <span class="n">jatom</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_edge</span><span class="p">([</span><span class="n">iatom</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">jatom</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">iatom</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">jatom</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_orderbonds</span><span class="p">[</span><span class="n">jatom</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">iatom</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">order</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xlist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zlist</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_topology_from_pdb"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_topology_from_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">read_topology_from_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to set up the topology reading a PDB file. The &quot;CONECT&quot; section is</span>
<span class="sd">        used to yield the connectivity of the molecule, if present. Otherwise, the</span>
<span class="sd">        bonds are guessed.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the PDB file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;PDB file for topology must be provided&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;chipar.segment.read_topology_from_pdb requires an existing file as argument&#39;</span><span class="p">)</span>

        <span class="n">isthereconnect</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CONECT&#39;</span><span class="p">):</span>
                <span class="n">l</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">jj</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">add_vertex</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">add_edge</span><span class="p">([</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">isthereconnect</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isthereconnect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">guess_bonds_topology</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

        <span class="c1"># DEBUG</span>
        <span class="c1"># print (self._topology)</span>
        <span class="c1"># self._topology.draw_graph(title=&quot;kk&quot;)</span>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_topology_from_xyz"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_topology_from_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">read_topology_from_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to set up the topology reading a XYZ file, the</span>
<span class="sd">        bonds are guessed.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the XYZ file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;XYZ file for topology must be provided&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;chipar.segment.read_topology_from_pdb requires an existing file as argument&#39;</span><span class="p">)</span>

        <span class="n">isthereconnect</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isthereconnect</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">guess_bonds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

        <span class="c1"># DEBUG</span>
        <span class="c1"># print (self._topology)</span>
        <span class="c1"># self._topology.draw_graph(title=&quot;kk&quot;)</span>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_xyz_from_scratch"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_xyz_from_scratch">[docs]</a>    <span class="k">def</span> <span class="nf">read_xyz_from_scratch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xyz_path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read the coordinates from a xyz file. It checks if the file exist</span>

<span class="sd">        Args:</span>
<span class="sd">            xyz_path (str): Path to the file in the disk</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">xyz_path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">xyz_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;XYZ file must be provided&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;chipar.segment.read_xyz_from_scratch requires an existing file as argument&#39;</span><span class="p">)</span>

        <span class="n">nparticles</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">xlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ylist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">zlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nparticles</span><span class="p">):</span>
            <span class="n">elem</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">xlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">ylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
            <span class="n">zlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
            <span class="n">elist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xlist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ylist</span><span class="p">),</span>
                                        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">zlist</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">elist</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="n">nparticles</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">),</span> \
            <span class="s2">&quot;Number of particles in the header is different to the read atoms in the xyz file&quot;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.set_charge"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.set_charge">[docs]</a>    <span class="k">def</span> <span class="nf">set_charge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">charge</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup the total charge of the segment</span>

<span class="sd">        Args:</span>
<span class="sd">            charge (int): Total charge of the segment</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_charge</span> <span class="o">=</span> <span class="n">charge</span>
        <span class="k">return</span> <span class="n">charge</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.set_topology_from_disk"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.set_topology_from_disk">[docs]</a>    <span class="k">def</span> <span class="nf">set_topology_from_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper to load the topology from disk. Allowed files are pdb, xyz and sdf files.</span>
<span class="sd">        The format of the file is taken from the extension of the file. If this extension is unkown then</span>
<span class="sd">        the method raises an exception.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the file in the disk</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span> <span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.pdb&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">nvert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_topology_from_pdb</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.xyz&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">nvert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_topology_from_xyz</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.gro&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Topology</span><span class="p">(</span><span class="n">nvert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_topology_from_gro</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.sdf&quot;</span><span class="p">:</span>
            <span class="s2">&quot;The topology is already set up in the &quot;</span> \
            <span class="s2">&quot;read_sdf_coordtopo_from_scratch method&quot;</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span> <span class="p">(</span><span class="s2">&quot;Unkown topology format for file: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unkown topology format for file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">path</span><span class="p">)</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.set_typeatoms"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.set_typeatoms">[docs]</a>    <span class="k">def</span> <span class="nf">set_typeatoms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetypeatoms</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the type of atoms in the segment (self._typeelements)</span>

<span class="sd">        Args:</span>
<span class="sd">            filetypeatoms (str): File containing the type of atoms</span>


<span class="sd">        .. code-block::</span>

<span class="sd">                &lt;Number&gt; &lt;Atom&gt; &lt;type_of_atom&gt;</span>
<span class="sd">                1 C c3</span>
<span class="sd">                2 C c3</span>
<span class="sd">                3 C c3</span>
<span class="sd">                ...</span>
<span class="sd">                14 H hc</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">typelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filetypeatoms</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">i</span><span class="p">,</span> <span class="n">el</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">typelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_typeelements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">typelist</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.translate_vector"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.translate_vector">[docs]</a>    <span class="k">def</span> <span class="nf">translate_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Translate the segment along the vector v.</span>
<span class="sd">        This function changes the coordinates of the segment</span>

<span class="sd">        .. image:: ../imgs/translation.png</span>
<span class="sd">            :width: 200pt</span>

<span class="sd">        The vector p represents the coordinates of each atom.</span>

<span class="sd">        Args:</span>
<span class="sd">            v: (type: a list or (1,3)-ndarray): The atoms are translated along this vector</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coords</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">iatom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_natoms</span><span class="p">):</span>
            <span class="n">c</span><span class="p">[</span><span class="n">iatom</span><span class="p">,:]</span> <span class="o">+=</span> <span class="n">v</span>

        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.write_xyz"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.write_xyz">[docs]</a>    <span class="k">def</span> <span class="nf">write_xyz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filenamexyz</span><span class="o">=</span><span class="s2">&quot;segment.xyz&quot;</span><span class="p">,</span> <span class="n">atomlist</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the segment to a XYZ file</span>

<span class="sd">        Args:</span>
<span class="sd">            filenamexyz (str): Name of the file</span>
<span class="sd">            atomlist (list): Index of the atoms to be written in the cxyz file. If ``None`` all atoms are written</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">c_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coords</span><span class="p">(</span><span class="n">atomlist</span> <span class="o">=</span> <span class="n">atomlist</span><span class="p">)</span>
        <span class="n">natoms</span> <span class="o">=</span> <span class="n">c_tmp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filenamexyz</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>

            <span class="n">w</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">natoms</span><span class="p">))</span>
            <span class="n">w</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="s2">&quot;Molecule </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filenamexyz</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">atomlist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">elem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">[</span><span class="n">atomlist</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

                <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2"> </span><span class="si">{1:.4f}</span><span class="s2"> </span><span class="si">{2:.4f}</span><span class="s2"> </span><span class="si">{3:.4f}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">c_tmp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">c_tmp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c_tmp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">w</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">line</span><span class="p">)</span></div>

    <span class="c1"># ***********************************************************************************</span>
<div class="viewcode-block" id="Segment.read_topology_from_gro"><a class="viewcode-back" href="../../source/segment.html#chiripa.Segment.Segment.read_topology_from_gro">[docs]</a>    <span class="k">def</span> <span class="nf">read_topology_from_gro</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Try to set up the topology reading a XYZ file, the</span>
<span class="sd">        bonds are guessed.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Path to the XYZ file</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerror</span><span class="p">(</span><span class="n">msg1</span><span class="o">=</span><span class="s2">&quot;GRO file for topology must be provided&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;chipar.segment.read_topology_from_gro requires an existing file as argument&#39;</span><span class="p">)</span>

        <span class="n">isthereconnect</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">isthereconnect</span><span class="p">:</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">_topology</span><span class="o">.</span><span class="n">guess_bonds</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_elements</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

        <span class="c1"># DEBUG</span>
        <span class="c1"># print (self._topology)</span>
        <span class="c1"># self._topology.draw_graph(title=&quot;kk&quot;)</span>

</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, J.Ramos

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>