

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>chiripa.Chi_Universe &mdash; Chiripa -- CHI inteRactIon PArameter. 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Chiripa -- CHI inteRactIon PArameter.
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/generalintro.html">General introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/setupstructures.html">Setup structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/keywords.html">Chiripa keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source/usermanual.html">USER MANUAL</a></li>
</ul>
<p class="caption"><span class="caption-text">API Python Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../source/api-docs.html">Python API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Chiripa -- CHI inteRactIon PArameter.</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>chiripa.Chi_Universe</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for chiripa.Chi_Universe</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">chiripa</span> <span class="k">as</span> <span class="nn">chi</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<div class="viewcode-block" id="Chi_Universe"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe">[docs]</a><span class="k">class</span> <span class="nc">Chi_Universe</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Create an universe to perform the calculations to get the |chi| parameter</span>

<span class="sd">    .. |chi| replace:: :math:`{\chi}`</span>

<span class="sd">    Args:</span>
<span class="sd">        * ``input_dict`` (dict): A dictionary of the required keywords to perform the calculation.</span>
<span class="sd">        * ``header`` (boolean, default=True): If True then prints the program header on the log file.</span>
<span class="sd">        * ``output_screen`` (boolean, default=False): If True then prints the log file on screen.</span>

<span class="sd">    The chi_universe creates the environment to calculate the |chi| parameter</span>
<span class="sd">    from the structure of the segments. A **input_dict** must be given in the signature.</span>
<span class="sd">    This dictionary codifies all information needed to perform calculations</span>
<span class="sd">    The allowed **key:values** pairs in this dictionary</span>
<span class="sd">    are the following:</span>

<span class="sd">        * **&#39;names&#39;** (required): A list of strings for the molecule names.</span>
<span class="sd">        * **&#39;filecoords&#39;** (required): A list of strings for filenames to read coordinates.</span>
<span class="sd">        * **&#39;filetop&#39;** (required): A list of strings for filenames to read topology.</span>
<span class="sd">        * **&#39;coordination_numbers_Z&#39;** (boolean, optional): If not present the coordination numbers (Z\ :sub:`ij`) are not calculated.</span>
<span class="sd">        * **&#39;Z-parameters&#39;** (dictionary, optional) : A dictionary defining the features of the Z-calculation.</span>
<span class="sd">        * **&#39;calculate_volume&#39;** (boolean, optional) : If True it calculates the monomer volume.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        The lists **&#39;names&#39;**, **&#39;filecoords&#39;**, **&#39;filetop&#39;** in the dictionary must have the same length. The order is also important,</span>
<span class="sd">        for example, the position 0 must correspond to the info of the Segment 1 and the position</span>
<span class="sd">        1 to the Segment 2.</span>

<span class="sd">    .. attention::</span>
<span class="sd">        Not all keys are defined.</span>

<span class="sd">    Properties:</span>
<span class="sd">        * self._names (list of string): Name of the segments</span>
<span class="sd">        * self._segments (list of segments): List of the two segments.</span>
<span class="sd">        * self._logger (Logger): Log to output the files.</span>

<span class="sd">    .. attention::</span>
<span class="sd">        Not all properties are defined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ========================================================================</span>
<div class="viewcode-block" id="Chi_Universe.__init__"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logname</span><span class="o">=</span><span class="s2">&quot;output.log&quot;</span><span class="p">,</span> <span class="n">output_screen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">clean</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%a</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/%m/%Y, %H:%M:%S&quot;</span>

        <span class="c1"># Clean files and exit ====================================================================</span>
        <span class="c1">#   full : Delete of files including the database</span>
        <span class="c1">#   light: Delete of files except the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span> <span class="o">=</span> <span class="n">clean</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_files</span><span class="p">()</span>

        <span class="c1"># List of names ============================================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create a list with segments (molecules) ==================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create a dictionaty for results ==========================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dictresults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="c1"># Logger for CHIRIPA =======================================================================</span>
        <span class="c1"># If Z_results.log file does not exist and it is not running or the  database does not exists then</span>
        <span class="c1"># chiripa assumes that this is the first time that we launch</span>
        <span class="c1"># the script, thus the sampling_run is deactivated. If QM calculations are running or finished,</span>
        <span class="c1"># two paths can be taken: i) perform sampling of the conformacions or check the runnning calculations</span>
        <span class="n">dblist</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.db&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Z_results.log&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Z_running_tmp.txt&quot;</span><span class="p">))</span>\
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dblist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">&quot;Output&quot;</span><span class="p">,</span> <span class="n">fileoutput</span><span class="o">=</span><span class="n">logname</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inscreen</span><span class="o">=</span><span class="n">output_screen</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__print_header</span><span class="p">()</span>
            <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;sampling_run&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">msg1</span> <span class="o">=</span> <span class="s2">&quot;Sampling run has been deactivated!!!!.&quot;</span>
        <span class="k">elif</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;sampling_run&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">&quot;Output&quot;</span><span class="p">,</span> <span class="n">fileoutput</span> <span class="o">=</span> <span class="s2">&quot;output_results.log&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inscreen</span><span class="o">=</span><span class="n">output_screen</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__print_header</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">&quot;Output&quot;</span><span class="p">,</span> <span class="n">fileoutput</span> <span class="o">=</span> <span class="s2">&quot;output_check.log&quot;</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inscreen</span><span class="o">=</span><span class="n">output_screen</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__print_header</span><span class="p">()</span>
        <span class="c1"># Print ===================================================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Job Information</span><span class="se">\n\t</span><span class="s2">---------------&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Starting: </span><span class="se">\t</span><span class="s2"> </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>

        <span class="c1"># Parse the input dictionary ==============================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">input_dict</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;sampling_run&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">):</span>
            <span class="c1">#  Collect energies in the database and perform sampling</span>
            <span class="c1">#self._collect_results_sequential()</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Sampling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingmode</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingtemperatures</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Setup Segments ==========================================================================</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setupSegments</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">],</span>
                                <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;filecoords&#39;</span><span class="p">],</span>
                                <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;filetop&#39;</span><span class="p">],</span> <span class="n">calculate_volume</span><span class="o">=</span><span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;calculate_volume&#39;</span><span class="p">])</span>

            <span class="c1"># TASKS in parallel =======================================================================</span>
            <span class="c1"># Tasks for z-calculation and qm claculations are independent, so they can be performed in parallel.</span>
            <span class="c1"># The task_zcoord launches the calculation of all pairs in the local machine.</span>
            <span class="c1"># The task_qm sends or checks the calculations on the remote or local server.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;coordination_numbers_Z&#39;</span><span class="p">]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_dict</span><span class="p">[</span><span class="s1">&#39;interaction_energy&#39;</span><span class="p">]]]</span>

            <span class="n">task_zcoord</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;daemon&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__zcalc</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],))</span>
            <span class="n">task_zcoord</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="n">task_qm</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;non-daemon&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__qmserver</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],))</span>
            <span class="n">task_qm</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

            <span class="n">task_zcoord</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="n">task_qm</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Finnish: </span><span class="se">\t</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span></div>

    <span class="c1"># ========================================================================</span>
    <span class="k">def</span> <span class="nf">__zcalc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_parameters</span><span class="p">):</span>

        <span class="n">task</span> <span class="o">=</span> <span class="n">list_of_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#0</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="n">list_of_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#input_dict[&#39;coordination_numbers_Z&#39;]</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"># Coordination number Z calculation (localhost)&quot;</span>
                   <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">-----------------------------------------------&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># TASK 0: Calculation of the coordination numbers Z ==============</span>
            <span class="c1"># parm is input_dict[&#39;coordination_numbers_Z&#39;]</span>
            <span class="k">if</span> <span class="n">parm</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Z_results.log&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Z_running_tmp.txt&quot;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="n">Z_results</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Z_calc_group</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filecoords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filetop</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Z_samples</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_Z_putTrialsMonomer</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_Z_nonbondedMethod</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_Z_debug</span><span class="p">,</span>
                                             <span class="n">workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
                <span class="c1"># Write Z results to a file</span>
                <span class="n">chi</span><span class="o">.</span><span class="n">write_Z_results</span><span class="p">(</span><span class="n">Z_results</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordination numbers won&#39;t be calculated.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;Z_results.log&quot;</span><span class="p">):</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Z values are already available in Z_results.log.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="c1"># ========================================================================</span>
    <span class="k">def</span> <span class="nf">__qmserver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_parameters</span><span class="p">):</span>

        <span class="n">task</span> <span class="o">=</span> <span class="n">list_of_parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#1</span>
        <span class="n">parm</span> <span class="o">=</span> <span class="n">list_of_parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#input_dict[&#39;interaction_energy&#39;]</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"># QM calculations at </span><span class="si">{}</span><span class="s2">&quot;</span>
                   <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">-----------------------------------------------&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">task</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span><span class="p">):</span>
                <span class="c1"># If file Done exists do not either download nor update the database</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">):</span>
                    <span class="c1"># Check the qm calculations</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_state_interaction_energy_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span><span class="p">)</span>

            <span class="c1"># Calculation of the interaction energies</span>
            <span class="k">elif</span> <span class="n">parm</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_interaction_energy_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filecoords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filetop</span><span class="p">)</span>

    <span class="c1"># ========================================================================</span>
<div class="viewcode-block" id="Chi_Universe._parse"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe._parse">[docs]</a>    <span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_input</span><span class="p">):</span>

        <span class="sa">R</span><span class="sd">&quot;&quot;&quot; Parser for the input dictionary.</span>

<span class="sd">        The format of the input has been defined in :py:class:`Chi_Universe`</span>

<span class="sd">        Args:</span>
<span class="sd">            dict_input (dict): Input dictionary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True when the input is well-formed. Otherwise, return False.</span>


<span class="sd">        All list must have the same length</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#==================</span>
        <span class="n">message</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"># Parse input dictionary</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;names&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">Field &#39;</span><span class="si">%s</span><span class="s2">&#39; in input dictionary must exist.&quot;</span> <span class="o">%</span> <span class="s1">&#39;names&#39;</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">The current dictionary is: </span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_input</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Field &#39;</span><span class="si">%s</span><span class="s2">&#39; in input dictionary must have exactly two items.&quot;</span> <span class="o">%</span> <span class="s1">&#39;names&#39;</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;Current value is: </span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="o">=</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;filecoords&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Field &#39;</span><span class="si">%s</span><span class="s2">&#39; in input dictionary must exist.&quot;</span> <span class="o">%</span> <span class="s1">&#39;filecoords&#39;</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;The current dictionary is: </span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_input</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;filecoords&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Field &#39;</span><span class="si">%s</span><span class="s2">&#39; in input dictionary must have exactly two items.&quot;</span> <span class="o">%</span> <span class="s1">&#39;filecoords&#39;</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;Current value is: </span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;filecoords&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filecoords</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;filecoords&#39;</span><span class="p">]</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;filetop&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Field &#39;</span><span class="si">%s</span><span class="s2">&#39; in input dictionary must exist.&quot;</span> <span class="o">%</span> <span class="s1">&#39;filetop&#39;</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;The current dictionary is: </span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_input</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;filetop&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Field &#39;</span><span class="si">%s</span><span class="s2">&#39; in input dictionary must have exactly two items.&quot;</span> <span class="o">%</span> <span class="s1">&#39;filetop&#39;</span>
            <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;Current value is: </span><span class="se">\n\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;filetop&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filetop</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;filetop&#39;</span><span class="p">]</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;boxl&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span> <span class="o">=</span> <span class="mf">30.0</span> <span class="c1">#in angstroms</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;boxl&#39;</span><span class="p">])</span>  <span class="c1"># in angstroms</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;sampling_run&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_run</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;\Sampling run selection is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;sampling_run&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_run</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Sampling run selection is TRUE.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;sampling_parameters&#39;</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingtemperatures</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;sampling_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;temperatures&#39;</span><span class="p">]</span>  <span class="c1"># in K</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingtemperatures</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># in K</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingmode</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;sampling_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span>
                            <span class="n">allowed_values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;metropolis&quot;</span><span class="p">,</span> <span class="s2">&quot;boltzmann&quot;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingmode</span> <span class="ow">in</span> <span class="n">allowed_values</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Sampling mode &#39;</span><span class="si">{}</span><span class="s2">&#39; unknown&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Samplingmode</span><span class="p">))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Sampling mode must be </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">allowed_values</span><span class="p">))</span>
                                <span class="n">exit</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingmode</span> <span class="o">=</span> <span class="s1">&#39;boltzmann&#39;</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingpairs</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;sampling_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;pairs&#39;</span><span class="p">]</span>  <span class="c1"># can be a list or a string</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_Samplingpairs</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>

                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;You must specify sampling_parameters input.&quot;</span><span class="p">)</span>
                    <span class="n">exit</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_run</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Sampling run selection is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;coordination_numbers_Z&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_run</span><span class="p">:</span>
            <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;coordination_numbers_Z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordination numbers is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default or user parameters for the Z-coordination calculation</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordination numbers is TRUE.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;coordination_numbers_Z&#39;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_samples</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;Z_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;Z_samples&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_samples</span> <span class="o">=</span> <span class="mi">20</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_putTrialsMonomer</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;Z_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;Z_puttrialmonomers&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_putTrialsMonomer</span> <span class="o">=</span> <span class="mi">1000</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_debug</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;Z_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;Z_debug&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_debug</span> <span class="o">=</span> <span class="kc">False</span>

                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_nonbondedMethod</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;Z_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;Z_nonbonded&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_Z_nonbondedMethod</span> <span class="o">=</span> <span class="s1">&#39;truhlar&#39;</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Z_samples</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Z_putTrialsMonomer</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Z_debug</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_Z_nonbondedMethod</span> <span class="o">=</span> <span class="s1">&#39;truhlar&#39;</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;calculate_volume&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_run</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Volume of the segments is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;calculate_volume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;calculate_volume&#39;</span><span class="p">]:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Volume of the segments is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Volume of the segments is TRUE.</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;interaction_energy&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sampling_run</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">DFT Interaction energies between segments is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;interaction_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.db&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">]:</span>
                    <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;interaction_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="o">+</span><span class="s1">&#39;_sp.db&#39;</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="o">+</span><span class="s1">&#39;_sp.db&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_conformations</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;number_configurations&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_conformations</span> <span class="o">=</span> <span class="mi">4</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_method</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_method&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_method</span> <span class="o">=</span> <span class="s1">&#39;hf&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_basisset</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_basisset&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_basisset</span> <span class="o">=</span> <span class="s1">&#39;3-21g&#39;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_charge</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_charge&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;You must specify the charge of the system &quot;</span><span class="p">)</span>
                        <span class="n">exit</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_scratch_dir&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_qm_scratch_dir</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_qm_scratch_dir</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_scratch_dir&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_scratch_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_qm_scratch_dir</span><span class="o">+=</span><span class="s2">&quot;/&quot;</span>

                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_scratch_dir</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_multiplicity</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_multiplicity&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">m</span> <span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">You must specify the multiplicity of the system &quot;</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

                        <span class="n">exit</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_task</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_task&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_task</span> <span class="o">=</span> <span class="s2">&quot;energy&quot;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_otherkeys</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_otherkeys&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_otherkeys</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_path_exe</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_path_exe&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;You must specify the path to </span><span class="si">{0:s}</span><span class="s2"> in &quot;</span> \
                                           <span class="s2">&quot;[energy_parameters input][qm_path_exe].&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        <span class="n">exit</span><span class="p">()</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_memory_mb</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_memory_mb&#39;</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_qm_memory_mb</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1">#Mb</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">DFT Interaction energies between segments is FALSE.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;interaction_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.db&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;energy_parameters&#39;</span><span class="p">][</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;You must specify energy_parameters input.&quot;</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>

        <span class="c1"># ==================</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;server&#39;</span> <span class="ow">in</span> <span class="n">dict_input</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Server: localhost.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;queue&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                                    <span class="s1">&#39;key_file&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;key_file&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span> <span class="o">=</span> <span class="s2">&quot;./calculations_local_dir/&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span> <span class="o">=</span> <span class="s2">&quot;./calculations_remote_dir/&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_nodelistmaster</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_partition</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_partitionmaster</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_memory_per_task</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cpus_per_task</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
            <span class="c1"># Check if the local directory exists, if False make the dir.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;Creation of the directory </span><span class="si">%s</span><span class="s2"> failed&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                    <span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Server in </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;You must specify a name for the server in &#39;server:name&#39; input.&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;localhost&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_username</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;You must specify a username for the server in &#39;server:username&#39; input.&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;key_file&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;local_dir&#39;</span><span class="p">]</span>
                <span class="c1"># local_dir must be a directory</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
                <span class="c1"># Check if the directory exists, if False make the dir.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;Creation of the directory </span><span class="si">%s</span><span class="s2"> failed&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        <span class="n">exit</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;remote_dir&#39;</span><span class="p">]</span>
                <span class="c1"># local_dir must be a directory</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;localhost&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">):</span>
                        <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">The remote_dir: </span><span class="si">{0:s}</span><span class="s2"> does not exist in localhost</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">)</span>
                        <span class="n">m</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Creating remote dir: ./calculations_remote_dir/</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span> <span class="o">=</span> <span class="s2">&quot;./calculations_remote_dir/&quot;</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                            <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;Creation of the directory </span><span class="si">%s</span><span class="s2"> failed&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span>
                            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                            <span class="n">exit</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">You must specify a remote dir for the server in </span><span class="si">{0:}</span><span class="s2">:</span><span class="si">{1:}</span><span class="s2"> input.&quot;</span>\
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cpus_per_task</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;ncpus&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_cpus_per_task</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_memory_per_task</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;memory&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_memory_per_task</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;nodelist&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nodelistmaster</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;nodelistmaster&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nodelistmaster</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_partition</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;partition&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_partition</span> <span class="o">=</span> <span class="s2">&quot;simacro&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_partitionmaster</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;partitionmaster&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_partitionmaster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_partition</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_jobs</span> <span class="o">=</span> <span class="n">dict_input</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;max_queue_jobs&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_jobs</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

    <span class="c1"># ========================================================================</span>
<div class="viewcode-block" id="Chi_Universe._setupSegments"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe._setupSegments">[docs]</a>    <span class="k">def</span> <span class="nf">_setupSegments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listnames</span><span class="p">,</span> <span class="n">listfilecoords</span><span class="p">,</span> <span class="n">listfiletop</span><span class="p">,</span> <span class="n">calculate_volume</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="sa">R</span><span class="sd">&quot;&quot;&quot; Segments to perform the calculations</span>

<span class="sd">        Args:</span>
<span class="sd">            listnames (list of strings): List of names for the segments</span>
<span class="sd">            listfilecoords (list of strings): List of the paths for the coordinates files</span>
<span class="sd">            listfiletop (list of strings): List of the paths for the topology files</span>
<span class="sd">            calculate_volume (boolean, default=False): Calculate the volume</span>
<span class="sd">                using :py:meth:`chiripa.Segment.Segment.calc_vdw_volume_VABC()`.</span>


<span class="sd">        This method setup the **self._segments** property</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">message</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"># Summary of the segments</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">-------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># Create segments</span>
        <span class="n">nsegments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">listfilecoords</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsegments</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filecoord</span><span class="o">=</span><span class="n">listfilecoords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filetop</span><span class="o">=</span><span class="n">listfiletop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">listnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">==========</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Segment </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">==========</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Name        : </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">listnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Coordinate  : </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">listfilecoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Topology    : </span><span class="si">{}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">listfiletop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">calculate_volume</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"># Volume of the  segments</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">-------------------------</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nsegments</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">v_vdw</span><span class="p">,</span> <span class="n">v_tsar</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">calc_vdw_volume_VABC</span><span class="p">()</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> VdW Volume of segment </span><span class="si">{:20s}</span><span class="s2"> = </span><span class="si">{:.1f}</span><span class="s2"> angstrom^3/molecule</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span>\
                                  <span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v_vdw</span><span class="p">)</span>

        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segments</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

    <span class="c1"># ========================================================================</span>
<div class="viewcode-block" id="Chi_Universe._interaction_energy_evaluation"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe._interaction_energy_evaluation">[docs]</a>    <span class="k">def</span> <span class="nf">_interaction_energy_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listnames</span><span class="p">,</span> <span class="n">listfilecoords</span><span class="p">,</span> <span class="n">listfiletop</span><span class="p">):</span>

        <span class="c1"># Write parameters  ===================================</span>
        <span class="n">message</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> QM engine       = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Number of pairs = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_conformations</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"># Server info&quot;</span>\
                   <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">-------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Server Name     = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> User Name       = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Key file        = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Local dir       = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote dir      = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="c1"># QM Keywords</span>
        <span class="n">qm_keywords</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                       <span class="s1">&#39;qm_method&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_method</span><span class="p">,</span>
                       <span class="s1">&#39;charge&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_charge</span><span class="p">,</span>
                       <span class="s1">&#39;scratch_dir&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_scratch_dir</span><span class="p">,</span>
                       <span class="s1">&#39;basis_set&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_basisset</span><span class="p">,</span>
                       <span class="s1">&#39;multiplicity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_multiplicity</span><span class="p">,</span>
                       <span class="s1">&#39;qm_path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_path_exe</span><span class="p">,</span>
                       <span class="s1">&#39;qm_task&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_task</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                       <span class="s1">&#39;other_keys&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_otherkeys</span><span class="p">,</span>
                       <span class="s1">&#39;mem_mb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_memory_mb</span><span class="p">,</span>
                       <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>

            <span class="c1"># Connect to the server *********************************</span>
            <span class="n">server</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">ServerSlurm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">server</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">ServerLocal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_database_name</span><span class="p">)</span>


        <span class="c1"># Inputs for monomers =================================================================</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filecoord</span><span class="o">=</span><span class="n">listfilecoords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filetop</span><span class="o">=</span><span class="n">listfiletop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="n">c</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">CubicBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">)</span>
            <span class="n">sim</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">mol</span><span class="o">=</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span> <span class="n">box</span><span class="o">=</span> <span class="n">c</span><span class="p">)</span>

            <span class="n">zipfile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_inputs_</span><span class="si">{:1d}</span><span class="s2">_</span><span class="si">{:1d}</span><span class="s2">.zip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qm_keywords</span><span class="p">[</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">server</span><span class="o">.</span><span class="n">qm_calc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                           <span class="n">qm_keywords</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_cpus_per_task</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">,</span> <span class="n">nodelistmaster</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nodelistmaster</span><span class="p">,</span>
                           <span class="n">partition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_partition</span><span class="p">,</span> <span class="n">partitionmaster</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_partitionmaster</span><span class="p">,</span>
                           <span class="n">localzipfile</span><span class="o">=</span><span class="n">zipfile</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory_per_task</span><span class="p">,</span>
                           <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">s1</span>
            <span class="k">del</span> <span class="n">s2</span>
            <span class="k">del</span> <span class="n">sim</span>

        <span class="c1"># Inputs for segments =================================================================</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filecoord</span><span class="o">=</span><span class="n">listfilecoords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filetop</span><span class="o">=</span><span class="n">listfiletop</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_names</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">filecoord</span><span class="o">=</span><span class="n">listfilecoords</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">filetop</span><span class="o">=</span><span class="n">listfiletop</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">CubicBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_boxl</span><span class="p">)</span>
                <span class="n">sim</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">Simulator</span><span class="p">(</span><span class="n">mol</span><span class="o">=</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span> <span class="n">box</span><span class="o">=</span> <span class="n">c</span><span class="p">)</span>

                <span class="n">zipfile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_inputs_</span><span class="si">{:1d}</span><span class="s2">_</span><span class="si">{:1d}</span><span class="s2">.zip&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qm_keywords</span><span class="p">[</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">],</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">server</span><span class="o">.</span><span class="n">qm_calc</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_conformations</span><span class="p">,</span>
                               <span class="n">qm_keywords</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_cpus_per_task</span><span class="p">,</span>
                               <span class="n">nodelist</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodelist</span><span class="p">,</span> <span class="n">nodelistmaster</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodelistmaster</span><span class="p">,</span>
                               <span class="n">partition</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_partition</span><span class="p">,</span> <span class="n">partitionmaster</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_partitionmaster</span><span class="p">,</span>
                               <span class="n">localzipfile</span><span class="o">=</span><span class="n">zipfile</span><span class="p">,</span> <span class="n">memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_memory_per_task</span><span class="p">,</span>
                               <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

                <span class="k">del</span> <span class="n">s1</span>
                <span class="k">del</span> <span class="n">s2</span>
                <span class="k">del</span> <span class="n">sim</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>
            <span class="c1"># Send qm jobs to slurm</span>
            <span class="n">server</span><span class="o">.</span><span class="n">qm_allsend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">,</span>
                              <span class="n">partitionmaster</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_partitionmaster</span><span class="p">,</span>
                              <span class="n">nodelistmaster</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_nodelistmaster</span><span class="p">,</span>
                              <span class="n">jobname</span><span class="o">=</span><span class="s2">&quot;sendAll&quot;</span><span class="p">,</span>
                              <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">,</span> <span class="n">maxjobsslurm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_queue_jobs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Send qm jobs to slurm</span>
            <span class="n">server</span><span class="o">.</span><span class="n">qm_allsend</span><span class="p">(</span><span class="n">qm_keywords</span><span class="p">[</span><span class="s1">&#39;qm_engine&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">,</span>
                              <span class="n">logger</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="c1"># ========================================================================</span>
<div class="viewcode-block" id="Chi_Universe._check_state_interaction_energy_evaluation"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe._check_state_interaction_energy_evaluation">[docs]</a>    <span class="k">def</span> <span class="nf">_check_state_interaction_energy_evaluation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">databasename</span><span class="p">):</span>

        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%a</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/%m/%Y, %H:%M:%S&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">#QM# Checking the energy calculations in the remote server ( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>

        <span class="n">message</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"># Server info&quot;</span>\
                   <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">-------------</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Server Name     = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> User Name       = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Key file        = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Local dir       = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote dir      = </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>

            <span class="n">server</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">ServerSlurm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">,</span> <span class="n">databasename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_file</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">server</span> <span class="o">=</span> <span class="n">chi</span><span class="o">.</span><span class="n">ServerLocal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="p">,</span> <span class="n">databasename</span><span class="o">=</span><span class="n">databasename</span><span class="p">)</span>

        <span class="c1"># 1. Extract energy from the log files.</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote Server: Extract energies ( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>
        <span class="c1"># Monomers</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">zipdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="o">+</span><span class="s2">&quot;_inputs_</span><span class="si">{:1d}</span><span class="s2">_</span><span class="si">{:1d}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">server</span><span class="o">.</span><span class="n">extract_energy_calculations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span>
                                                      <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="o">+</span><span class="n">zipdir</span><span class="p">,</span> <span class="n">qm_engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="p">)</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2"> Monomer energies extracted ( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>
        <span class="c1"># Pairs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">zipdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="o">+</span><span class="s2">&quot;_inputs_</span><span class="si">{:1d}</span><span class="s2">_</span><span class="si">{:1d}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">server</span><span class="o">.</span><span class="n">extract_energy_calculations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span>
                                                          <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="o">+</span><span class="n">zipdir</span><span class="p">,</span> <span class="n">qm_engine</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t\t</span><span class="s2"> Pair </span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2"> energies extracted ( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>

        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote Server: Extract energies for all pairs in </span><span class="si">{:.1f}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>

        <span class="c1"># 2. Get the files containing the energies.</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote Server: Get summary files ( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>
        <span class="n">server</span><span class="o">.</span><span class="n">get_energy_from_calculations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_qm_engine</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote Server: Get summary files for all pairs in </span><span class="si">{:.1f}</span><span class="s2"> seconds</span><span class="se">\n</span><span class="s2">&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>

        <span class="c1"># 3. Get the gaussian logs for future references.</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote Server: Get log files ( </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span>
        <span class="n">server</span><span class="o">.</span><span class="n">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remote_dir</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> Remote Server: Get log files for all pairs in </span><span class="si">{:.1f}</span><span class="s2"> seconds&quot;</span>
                          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elapsed_time</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_servername</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;localhost&#39;</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">close_connection</span><span class="p">()</span>

        <span class="c1"># 4. Check the database if all calculations have been perfomed and write results in the log</span>
        <span class="n">total</span><span class="p">,</span> <span class="n">inserver</span><span class="p">,</span> <span class="n">pending</span><span class="p">,</span> <span class="n">complete</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">running</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">_db_base</span><span class="o">.</span><span class="n">account_qm</span><span class="p">(</span><span class="s2">&quot;qm_jobs&quot;</span><span class="p">)</span>

        <span class="c1"># Monomers</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2"> NAME         TOTAL_JOBS INSERVER_JOBS  PENDING_JOBS  RUNNING_JOBS  COMPLETE_JOBS  ERROR_JOBS</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">================================================================================================&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Monomer </span><span class="si">{0:1d}</span><span class="s2">  :</span><span class="se">\t</span><span class="si">{1:4d}</span><span class="se">\t\t</span><span class="si">{2:4d}</span><span class="se">\t\t</span><span class="si">{3:4d}</span><span class="se">\t\t\t</span><span class="si">{4:4d}</span><span class="se">\t\t\t</span><span class="si">{5:4d}</span><span class="se">\t\t</span><span class="si">{6:4d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span>\
                <span class="nb">format</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">total</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">inserver</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">pending</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">running</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">complete</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">error</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># Pairs</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Segment </span><span class="si">{0:1d}</span><span class="s2">_</span><span class="si">{1:1d}</span><span class="s2">: </span><span class="se">\t</span><span class="si">{2:4d}</span><span class="se">\t\t</span><span class="si">{3:4d}</span><span class="se">\t\t</span><span class="si">{4:4d}</span><span class="se">\t\t\t</span><span class="si">{5:4d}</span><span class="se">\t\t\t</span><span class="si">{6:4d}</span><span class="se">\t\t</span><span class="si">{7:4d}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span>\
                    <span class="nb">format</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">total</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">inserver</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">pending</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">running</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">complete</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">error</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">================================================================================================&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">is_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">total</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">total</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">complete</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="n">error</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                <span class="n">is_done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">is_done</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Done&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%a</span><span class="s2"> </span><span class="si">%d</span><span class="s2">/%m/%Y, %H:%M:%S&quot;</span>
                <span class="n">l</span> <span class="o">=</span> <span class="s2">&quot;QM work is done </span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">fmt</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">l</span><span class="p">)</span></div>


    <span class="c1"># ========================================================================</span>
    <span class="k">def</span> <span class="nf">__print_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">msg</span> <span class="o">=</span><span class="s2">&quot;&quot;&quot;                       </span>
<span class="s2">        ***********************************************************************</span>
<span class="s2">                         CHI inteRactIon PArameter (CHIRIPA)</span>
<span class="s2">                         -----------------------------------</span>
<span class="s2">                         </span>
<span class="s2">                                    Version 1.0</span>
<span class="s2">                         </span>
<span class="s2">                                  Dr. Javier Ramos</span>
<span class="s2">                          Macromolecular Physics Department</span>
<span class="s2">                    Instituto de Estructura de la Materia (IEM-CSIC)</span>
<span class="s2">                                   Madrid (Spain)</span>
<span class="s2">                                   </span>
<span class="s2">                Chiripa is an open-source python library to calculate</span>
<span class="s2">                the Flory-Huggins interaction parameter (chi) between</span>
<span class="s2">                two molecular segments. Chiripa is a coloquial spanish</span>
<span class="s2">                word meaning &quot;stroke of luck&quot;</span>
<span class="s2">                </span>
<span class="s2">                This software is distributed under the terms of the</span>
<span class="s2">                GNU General Public License v3.0 (GNU GPLv3). A copy of </span>
<span class="s2">                the license (LICENSE.txt) is included with this distribution </span>
<span class="s2">                </span>
<span class="s2">        ***********************************************************************</span>
<span class="s2">                     </span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># ========================================================================</span>
<div class="viewcode-block" id="Chi_Universe._clean_files"><a class="viewcode-back" href="../../source/chi_universe.html#chiripa.Chi_Universe.Chi_Universe._clean_files">[docs]</a>    <span class="k">def</span> <span class="nf">_clean_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                <span class="c1"># Delete input files</span>
                <span class="n">filelist1</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*_inputs_?_?.zip&quot;</span><span class="p">)</span>
                <span class="c1"># Delete summary files</span>
                <span class="n">filelist2</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;summary_*.txt&quot;</span><span class="p">)</span>
                <span class="c1"># Delete logs file</span>
                <span class="n">filelist3</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;logs.zip&quot;</span><span class="p">)</span>
                <span class="c1"># Delete sh scripts</span>
                <span class="n">filelist4</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.sh&quot;</span><span class="p">)</span>
                <span class="c1"># Delete sh scripts</span>
                <span class="n">filelist5</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*.log&quot;</span><span class="p">)</span>
                <span class="n">filelist</span> <span class="o">=</span> <span class="n">filelist1</span> <span class="o">+</span> <span class="n">filelist2</span> <span class="o">+</span> <span class="n">filelist3</span> <span class="o">+</span><span class="n">filelist4</span> <span class="o">+</span><span class="n">filelist5</span>
                <span class="k">for</span> <span class="n">ifile</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ifile</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;full&quot;</span><span class="p">:</span>

                    <span class="c1"># Delete Z_results</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;./Z_results.log&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                        <span class="k">pass</span>

                    <span class="c1"># Delete the database</span>
                    <span class="n">ifile</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;*_sp.db&quot;</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ifile</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="k">return</span></div></div>




</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, J.Ramos

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>